import sys
import os
import numpy as np

# Ensure src is in path
project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), '../../'))
src_path = os.path.join(project_root, 'src')
if src_path not in sys.path:
    sys.path.insert(0, src_path)

from mem4ristor.core import Mem4ristorV2

def attack_solver_blindness():
    print("üöÄ Attaque Solver Blindness sur solve_rk45()...")
    
    model = Mem4ristorV2(seed=42)
    model._initialize_params(N=100)
    
    # On cr√©e une matrice d'adjacence MALFORM√âE
    # Le mod√®le attend N=100. On lui donne (101, 100).
    bad_matrix = np.random.rand(101, 100) 
    
    try:
        print("‚öôÔ∏è Appel de solve_rk45 avec une matrice (101, 100) au lieu de (100, 100)...")
        model.solve_rk45(t_span=(0, 1), adj_matrix=bad_matrix)
        print("‚ùå √âchec de l'attaque : Le solver a surv√©cu (inattendu).")
        sys.exit(0)
        
    except ValueError as e:
        if "concatenation" in str(e).lower() or "shape" in str(e).lower() or "dimension" in str(e).lower() or "mismatch" in str(e).lower():
             print(f"üí• CRASH R√âUSSI (Target 1) : Erreur de dimension critique dans le solver !\n   D√©tail : {e}")
             sys.exit(1) # Exploit successful
        else:
             print(f"‚ö†Ô∏è ValueError autre : {e}")
             sys.exit(0)
    except Exception as e:
        print(f"üí• Autre Crash : {type(e).__name__} {e}")
        sys.exit(1)

if __name__ == "__main__":
    attack_solver_blindness()
