import sys
import os
import numpy as np

# Ensure src is in path
project_root = os.path.abspath(os.path.join(os.path.dirname(__file__), '../../'))
src_path = os.path.join(project_root, 'src')
if src_path not in sys.path:
    sys.path.insert(0, src_path)

from mem4ristor.core import Mem4ristorV2

def attack_invalid_config():
    print("ğŸš€ Attaque Invalid Config (Heretic Ratio)...")
    
    # Essayer de planter l'initialisation avec un ratio hÃ©rÃ©tique > 1 (Impossible physiquement)
    # Ce qui provoque un "step = 0" dans la boucle de placement.
    try:
        print("âš™ï¸ Test : heretic_ratio = 2.0 (Physiquement impossible, > 100%)")
        config = {
            'coupling': {'heretic_ratio': 2.0}
        }
        model = Mem4ristorV2(config=config) # removed N=100 as it might overwrite config
        model._initialize_params(N=100)
        
        print("âŒ Ã‰chec de l'attaque : Le ratio > 1 a Ã©tÃ© acceptÃ© sans crash (Physics Break).")
        sys.exit(1) # Exploit successful (Logic break)
        
    except ValueError as e:
        if "step" in str(e).lower() or "zero" in str(e).lower():
            print(f"ğŸ’¥ CRASH RÃ‰USSI (Target 1) : Boucle d'initialisation cassÃ©e par un ratio > 1 !\n   DÃ©tail : {e}")
            sys.exit(1)
        else:
            print(f"ğŸ›¡ï¸ BloquÃ© correctement : {e}")
            sys.exit(0)
    except ZeroDivisionError:
         print(f"ğŸ’¥ CRASH RÃ‰USSI (Target 1) : Division par zÃ©ro !")
         sys.exit(1)
    except Exception as e:
        print(f"ğŸ’¥ Crash Inattendu : {type(e).__name__} {e}")
        sys.exit(1)

if __name__ == "__main__":
    attack_invalid_config()
